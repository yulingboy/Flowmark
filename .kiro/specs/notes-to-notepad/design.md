# Design Document: è®°äº‹æœ¬æ’ä»¶ä¼˜åŒ–

## Overview

æœ¬è®¾è®¡æ–‡æ¡£æè¿°å°†ç°æœ‰"ä¾¿ç­¾"æ’ä»¶é‡å‘½åä¸º"è®°äº‹æœ¬"å¹¶ä¼˜åŒ–é¡µé¢æ ·å¼çš„æŠ€æœ¯æ–¹æ¡ˆã€‚ä¸»è¦æ”¹åŠ¨åŒ…æ‹¬ï¼šæ›´æ–°æ’ä»¶å…ƒæ•°æ®ã€é‡æ–°è®¾è®¡ç©ºçŠ¶æ€ç•Œé¢ã€ä¼˜åŒ–ç¬”è®°å¡ç‰‡æ ·å¼ã€æ”¹è¿›äº¤äº’ä½“éªŒã€‚

## Architecture

### ç»„ä»¶ç»“æ„

```
src/plugins/builtin/notes/
â”œâ”€â”€ index.ts              # æ’ä»¶å®šä¹‰ï¼ˆæ›´æ–°å…ƒæ•°æ®ï¼‰
â””â”€â”€ NotesWidget.tsx       # ä¸»ç»„ä»¶ï¼ˆé‡æ„æ ·å¼ï¼ŒåŒ…å«ç©ºçŠ¶æ€å’Œç¬”è®°å¡ç‰‡ï¼‰
```

### è®¾è®¡å†³ç­–

1. **ç›´æ¥ä¿®æ”¹ç°æœ‰æ–‡ä»¶** - åœ¨ NotesWidget.tsx ä¸­ç›´æ¥å®ç°æ‰€æœ‰æ”¹åŠ¨ï¼Œç®€åŒ–ç»“æ„
2. **CSS-in-JS é£æ ¼** - ç»§ç»­ä½¿ç”¨ Tailwind CSSï¼Œä¿æŒé¡¹ç›®ä¸€è‡´æ€§
3. **SVG æ’å›¾** - ä½¿ç”¨å†…è” SVG å®ç°ç©ºçŠ¶æ€æ’å›¾ï¼Œé¿å…å¤–éƒ¨ä¾èµ–

## Components and Interfaces

### 1. æ’ä»¶å…ƒæ•°æ®æ›´æ–°

```typescript
// index.ts
export const notesPlugin: Plugin = {
  metadata: {
    id: 'notes',
    name: 'è®°äº‹æœ¬',  // ä»"ä¾¿ç­¾"æ”¹ä¸º"è®°äº‹æœ¬"
    version: '1.1.0',
    description: 'æ‚¨å¯ä»¥ä½¿ç”¨è®°äº‹æœ¬æ¥è®°å½•æ‚¨çš„æƒ³æ³•æˆ–è€…è®°å½•ä¸€äº›æ‚¨çš„ç”Ÿæ´»ç‚¹æ»´',
    author: 'Built-in',
    icon: 'ğŸ“'
  },
  // ... å…¶ä»–é…ç½®ä¿æŒä¸å˜
};
```

### 2. EmptyState ç»„ä»¶

```typescript
interface EmptyStateProps {
  onCreateNote: () => void;
}

// æ˜¾ç¤ºæ¬¢è¿ç•Œé¢ï¼ŒåŒ…å«ï¼š
// - è“è‰²æ¸å˜é£æ ¼çš„æ’å›¾ï¼ˆä¿¡å°+æ–‡æ¡£å›¾æ¡ˆï¼‰
// - æ ‡é¢˜ï¼š"æ¬¢è¿ä½¿ç”¨è®°äº‹æœ¬"
// - å‰¯æ ‡é¢˜ï¼šåŠŸèƒ½è¯´æ˜
// - "æ–°å»ºç¬”è®°"æŒ‰é’®
```

### 3. NoteCard ç»„ä»¶

```typescript
interface NoteCardProps {
  note: Note;
  isEditing: boolean;
  onEdit: () => void;
  onUpdate: (content: string) => void;
  onUpdateColor: (color: string) => void;
  onDelete: () => void;
  onBlur: () => void;
}

// åŠŸèƒ½ï¼š
// - æ˜¾ç¤ºç¬”è®°å†…å®¹ï¼ˆæ”¯æŒæˆªæ–­ï¼‰
// - æ˜¾ç¤ºæ›´æ–°æ—¶é—´
// - æ‚¬åœæ˜¾ç¤ºæ“ä½œæŒ‰é’®
// - æ”¯æŒå†…è”ç¼–è¾‘
```

### 4. NotesModal ç»„ä»¶é‡æ„

```typescript
// ä¸»è¦æ”¹åŠ¨ï¼š
// - ä½¿ç”¨ EmptyState ç»„ä»¶å¤„ç†ç©ºçŠ¶æ€
// - ä½¿ç”¨ NoteCard ç»„ä»¶æ¸²æŸ“ç¬”è®°åˆ—è¡¨
// - ä¼˜åŒ–æŒ‰é’®æ ·å¼ä¸ºè“è‰²æ¸å˜
// - æ”¹è¿›æ•´ä½“å¸ƒå±€å’Œé—´è·
```

## Data Models

### Note æ¥å£ï¼ˆä¿æŒä¸å˜ï¼‰

```typescript
interface Note {
  id: string;
  content: string;
  color: string;
  createdAt: number;
  updatedAt: number;
}
```

### NotesConfig æ¥å£ï¼ˆä¿æŒä¸å˜ï¼‰

```typescript
interface NotesConfig {
  layout: 'grid' | 'list';
  defaultColor: string;
}
```

## UI è®¾è®¡è§„èŒƒ

### é¢œè‰²æ–¹æ¡ˆ

| ç”¨é€” | é¢œè‰²å€¼ |
|------|--------|
| ä¸»è‰²è°ƒï¼ˆæŒ‰é’®èƒŒæ™¯ï¼‰ | `#3b82f6` (blue-500) |
| æŒ‰é’®æ‚¬åœ | `#2563eb` (blue-600) |
| æ’å›¾ä¸»è‰² | `#93c5fd` (blue-300) |
| æ’å›¾æ·±è‰² | `#60a5fa` (blue-400) |
| æ–‡å­—ä¸»è‰² | `#374151` (gray-700) |
| æ–‡å­—æ¬¡è¦ | `#9ca3af` (gray-400) |

### é—´è·è§„èŒƒ

- å®¹å™¨å†…è¾¹è·ï¼š`p-6`
- å¡ç‰‡é—´è·ï¼š`gap-4`
- æŒ‰é’®å†…è¾¹è·ï¼š`px-6 py-3`

### åœ†è§’è§„èŒƒ

- æŒ‰é’®åœ†è§’ï¼š`rounded-full`
- å¡ç‰‡åœ†è§’ï¼š`rounded-xl`
- å®¹å™¨åœ†è§’ï¼š`rounded-lg`



## Correctness Properties

*A property is a characteristic or behavior that should hold true across all valid executions of a systemâ€”essentially, a formal statement about what the system should do. Properties serve as the bridge between human-readable specifications and machine-verifiable correctness guarantees.*

åŸºäºéœ€æ±‚åˆ†æï¼Œæœ¬åŠŸèƒ½ä¸»è¦æ¶‰åŠ UI æ ·å¼ä¼˜åŒ–ï¼Œå¤§éƒ¨åˆ†éœ€æ±‚æ˜¯è§†è§‰ç›¸å…³çš„ï¼Œéš¾ä»¥é€šè¿‡å±æ€§æµ‹è¯•éªŒè¯ã€‚ä»¥ä¸‹æ˜¯å¯æµ‹è¯•çš„å±æ€§ï¼š

### Property 1: ç¬”è®°æ—¶é—´æ˜¾ç¤ºä¸€è‡´æ€§

*For any* Note å¯¹è±¡ï¼Œå½“æ¸²æŸ“ NoteCard ç»„ä»¶æ—¶ï¼Œè¾“å‡ºåº”è¯¥åŒ…å«è¯¥ç¬”è®°çš„æ›´æ–°æ—¶é—´ä¿¡æ¯ã€‚

**Validates: Requirements 3.3**

### Property 2: å“åº”å¼å¸ƒå±€æ­£ç¡®æ€§

*For any* æ”¯æŒçš„å¡ç‰‡å°ºå¯¸ï¼ˆ'1x1', '2x2', '2x4'ï¼‰ï¼ŒNotesCard ç»„ä»¶åº”è¯¥èƒ½å¤Ÿæ­£ç¡®æ¸²æŸ“è€Œä¸æŠ›å‡ºé”™è¯¯ã€‚

**Validates: Requirements 5.4**

## Error Handling

### ç©ºçŠ¶æ€å¤„ç†

- å½“ notes æ•°ç»„ä¸ºç©ºæˆ– undefined æ—¶ï¼Œæ˜¾ç¤º EmptyState ç»„ä»¶
- ä½¿ç”¨é»˜è®¤å€¼ `[]` åˆå§‹åŒ– notes çŠ¶æ€

### æ—¶é—´æ ¼å¼åŒ–é”™è¯¯

- ä½¿ç”¨ try-catch åŒ…è£…æ—¶é—´æ ¼å¼åŒ–é€»è¾‘
- å¦‚æœæ—¶é—´æˆ³æ— æ•ˆï¼Œæ˜¾ç¤º"æœªçŸ¥æ—¶é—´"

### ç»„ä»¶æ¸²æŸ“é”™è¯¯

- ä½¿ç”¨ React ErrorBoundary æ•è·æ¸²æŸ“é”™è¯¯
- æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤ºè€Œéå´©æºƒ

## Testing Strategy

### å•å…ƒæµ‹è¯•

ä½¿ç”¨ Vitest + React Testing Library è¿›è¡Œå•å…ƒæµ‹è¯•ï¼š

1. **æ’ä»¶å…ƒæ•°æ®æµ‹è¯•**
   - éªŒè¯ name ä¸º"è®°äº‹æœ¬"
   - éªŒè¯ description åŒ…å«æ­£ç¡®æ–‡æ¡ˆ

2. **EmptyState ç»„ä»¶æµ‹è¯•**
   - éªŒè¯æ ‡é¢˜æ–‡æœ¬æ­£ç¡®
   - éªŒè¯å‰¯æ ‡é¢˜æ–‡æœ¬æ­£ç¡®
   - éªŒè¯"æ–°å»ºç¬”è®°"æŒ‰é’®å­˜åœ¨
   - éªŒè¯ç‚¹å‡»æŒ‰é’®è§¦å‘å›è°ƒ

3. **NoteCard ç»„ä»¶æµ‹è¯•**
   - éªŒè¯æ˜¾ç¤ºç¬”è®°å†…å®¹
   - éªŒè¯æ˜¾ç¤ºæ—¶é—´ä¿¡æ¯
   - éªŒè¯åŒ…å«æ­£ç¡®çš„æ ·å¼ç±»å

4. **NotesModal ç»„ä»¶æµ‹è¯•**
   - éªŒè¯ç©ºçŠ¶æ€æ—¶æ˜¾ç¤º EmptyState
   - éªŒè¯æœ‰ç¬”è®°æ—¶æ˜¾ç¤ºç¬”è®°åˆ—è¡¨

### å±æ€§æµ‹è¯•

ä½¿ç”¨ fast-check è¿›è¡Œå±æ€§æµ‹è¯•ï¼š

1. **Property 1: æ—¶é—´æ˜¾ç¤ºä¸€è‡´æ€§**
   - ç”Ÿæˆéšæœº Note å¯¹è±¡
   - æ¸²æŸ“ NoteCard
   - éªŒè¯è¾“å‡ºåŒ…å«æ—¶é—´ä¿¡æ¯
   - æœ€å°‘è¿è¡Œ 100 æ¬¡è¿­ä»£

2. **Property 2: å“åº”å¼å¸ƒå±€æ­£ç¡®æ€§**
   - éå†æ‰€æœ‰æ”¯æŒçš„å°ºå¯¸
   - æ¸²æŸ“ NotesCard
   - éªŒè¯ä¸æŠ›å‡ºé”™è¯¯
   - æœ€å°‘è¿è¡Œ 100 æ¬¡è¿­ä»£

### æµ‹è¯•é…ç½®

```typescript
// vitest.config.ts ä¸­å·²é…ç½®æµ‹è¯•ç¯å¢ƒ
// ä½¿ç”¨ @testing-library/react è¿›è¡Œç»„ä»¶æµ‹è¯•
// ä½¿ç”¨ fast-check è¿›è¡Œå±æ€§æµ‹è¯•
```
